#

> 基于 STM32F103C8T6 的无人值守机房监控系统：多传感器采集 → MQTT 上云（阿里云 IoT）→ 规则引擎入库 RDS → Web 前端可视化，并支持风扇/水泵/蜂鸣器本地与远程联动控制。

##
- 传感器：温湿度(DHT11)、烟雾/可燃气体(MQ-2)、CO₂(JW01)、红外入侵(E18-D80NK)  
- 本地执行：风扇 / 水泵 / 蜂鸣器 / LED / 0.96" I2C OLED 实时显示  
- 通信：ESP-01S Wi-Fi（AT 指令）+ MQTT 与阿里云 IoT 双向通信（上报属性、接收控制）  
- 云端：物模型定义、规则引擎数据流转 → RDS(MySQL)；App/控制台下发指令  
- Web：Flask + PyMySQL + pandas + matplotlib 历史数据图表、导出 Excel  
- 模式：自动/手动切换；本地按键在断网时仍可应急控制

##
感知层(多传感器) → 传输层(ESP-01S + MQTT) → 应用层(阿里云 IoT + RDS + Web 可视化)。系统采用物联网三层架构与模块化设计，支持本地阈值设置与联动执行。  



##
- ****
- **工具**
- **主要模块**：  
  - 传感器驱动与采样（定时任务/中断，含 DHT11 40-bit 时序采集与校验） 
  - OLED I²C 显示（中文/数值刷新流程） 
  - Wi-Fi 驱动（ESP-01S AT 指令：`` 入网、`` 透传、`` 查询 IP）
  - MQTT 客户端（属性上报、订阅下发、心跳与断线重连） 
  - 自动/手动模式、本地按键应急控制与阈值设置

###
 打开工程，配置目标为 ``。  
 编译并下载固件到板子（ST-Link ）。  
 上电后串口/屏幕应显示实时传感器数据，键控可切换模式与阈值。  


##
 **创建产品 & 物模型**：添加温度/湿度/CO₂/烟雾等属性字段。 
 **创建设备**：获取三元组 ``（设备认证）。  
 **MQTT 通信**：设备以三元组生成 ``，CONNECT→CONNACK；订阅下行 Topic；定期上报与心跳。 
 ****：按照物模型的属性上报/服务下发 Topic（参考产品订阅列表）。 
 **在线验证**：控制台查看设备“在线”状态，物模型数据实时刷新；在平台下发 `` 等指令核对设备响应。

##
- 使用**规则引擎**将上报 Topic 作为**数据源**，RDS 作为**数据目的**，中间加**解析器**做字段映射，完成自动流转入库。 
- 购置/开通 RDS、放通白名单、创建数据库与表（ ``等），并确保读写权限正确。 
。 

##
- **栈**
- **功能**：时间范围查询、折线图展示温湿度/CO₂/烟雾等、数据导出 Excel。
- **运行**：
  ```bash
  pip install flask pymysql pandas matplotlib
  export DB_URL="mysql://user:pass@host:3306/lzx"
  python app.py
